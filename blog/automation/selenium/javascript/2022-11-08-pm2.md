---
slug: pm2
title: Part 2 - PM2 Implementation
authors: [harryvn]
tags: [selenium, javascript, pm2]
---

PM2 Implementation

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<!-- truncate -->

---

## Introduction

In the previous [article](/blog/selenium-framework-javascript) we learned how to create a basic automation framework from scratch. We also learned to start & run a selenium-standalone server as a foreground process and terminate it manually using the escape sequence `ctrl+c`.

In this article, we will learn how to run the selenium-standalone server as a detached process using `PM2`.

---

## Implementation

:::info PM2 is a manager to keep an application process daemonised using the CLI, if you want to know more check [here](https://pm2.io/).
:::

### Step 1 - Install Dependency

```bash
npm i -g pm2
```

:::note installing PM2 as a global dependency is recommended.
:::

---

### Step 2 - Configuration

Let's create a file `ecosystem.config.js` at the project root as recommended in [PM2](https://pm2.keymetrics.io/docs/usage/application-declaration/) documentation.

```bash
pm2 init simple
```

```js
module.exports = {
  apps: [
    {
      name: "standalone-server",
      script: "./app.js",
    },
  ],
};
```

Next, we will create an `app.js` file at the project root.

:::note we will be using NodeJS "child_process" to execute npm commands.
:::

```js
const { exec } = require("child_process");
exec("npm run setup && npm start");
```

:::note here we are running the "setup" first to ensure the browser driver dependencies are installed before starting the server.
:::

---

### Step 3 - Start Server

Let's now start the selenium-standalone server as a daemonised process.

```bash
pm2 start ecosystem.config.js
```

![image](https://user-images.githubusercontent.com/4848094/194100702-7b07638b-f214-4f3b-b063-41b49b7b7dc2.png)

:::note the above command will start the selenium server in the background, you can access it at `http://localhost:4444`.
:::

![image](https://user-images.githubusercontent.com/4848094/194100940-1c9d9619-5f7c-4cd6-920a-5e4722a07e3b.png)

---

### Step 4 - Run Tests

Let's execute the test cases.

```bash
npm test
```

---

### Step 5 - Stop Server

Once the test cases are executed and there are no more tests to run, we can stop the server process.

:::note the stopped process can be started anytime as mentioned in Step 3.
:::

```bash
pm2 stop ecosystem.config.js
```

![image](https://user-images.githubusercontent.com/4848094/194101095-80773421-6e98-4910-b3d1-2b360406466f.png)

---

### Step 6 - Dispose Server

We can also delete the server process at any point in time.

```bash
pm2 delete ecosystem.config.js
```

![image](https://user-images.githubusercontent.com/4848094/194101205-d480d094-bc35-4059-85f7-a8f0a892e119.png)

---

## Logs

By default, PM2 stores two types of logs as below

- global logs at `$HOME/.pm2/pm2.log`

- application logs at `$HOME/.pm2/logs/`

To display all the logs in realtime, run the following command.

```bash
pm2 logs
```

<img src={require('@site/static/img/javascript/all-logs.avif').default} alt="all-logs" />

To display application logs, run the following command.

```bash
pm2 logs selenium-standalone
```

<img src={require('@site/static/img/javascript/app-logs.avif').default} alt="app-logs" />

---

## Monitoring

We can also monitor the application logs using the below command.

```bash
pm2 monit
```

<img src={require('@site/static/img/javascript/monit.avif').default} alt="monit" />

:::note The above image is just a sample.
:::

---

## Conclusion

So far, we learned how to create a bare minimum automation framework from scratch, we also learned how to daemonize the selenium-standalone server to run as a background process on a standalone operating system.

In the next [article], we will learn to execute the automation scripts on docker containers, a live preview and much more in action.

The source code is available at [GitHub](https://github.com/harryvn/automation-framework).

If you find this article useful or have any suggestions, reach out to me on [LinkedIn](https://www.linkedin.com/in/harryvn/).

Thank you and keep learning!
